name: Validate Test Data

on:
  pull_request:
    paths:
      - '**/*.png'
      - '**/*.jpg'
      - '**/*.jpeg'
      - '**/*.webp'
      - '**/*.avif'
      - '**/*.expected.json'
  workflow_dispatch:

jobs:
  validate-subsets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Test Data
        uses: actions/checkout@v4
        with:
          path: ocr-test-data

      - name: Checkout Mangatan Logic
        uses: actions/checkout@v4
        with:
          repository: KolbyML/Mangatan
          path: mangatan

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y nasm

      - name: Setup Rust
        uses: actions-rust-lang/setup-rust-toolchain@v1
        with:
          toolchain: stable

      - name: Run Validation Logic
        working-directory: mangatan
        # Now we just run the test that exists in the repo
        run: cargo test --package mangatan-ocr-server --test validate_submission -- --nocapture